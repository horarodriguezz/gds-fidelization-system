---
import {
  Gift,
  LayoutDashboard,
  LogOut,
  Settings,
  ShoppingCart,
  Store,
  Users,
} from "@lucide/astro";
import { Pathname } from "@/config/Pathname";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { BusinessService } from "../../../api/business/business.service";
import { APP_NAME } from "../../../config/app";
import { BUSINESS_TOKEN_KEY } from "../../../config/localStorage";

interface Props {
  onNavigate?: () => void;
}

const navigation = [
  {
    name: "Dashboard",
    href: Pathname.BUSINESS_DASHBOARD,
    icon: LayoutDashboard,
  },
  {
    name: "Clientes",
    href: Pathname.BUSINESS_CLIENTS,
    icon: Users,
  },
  {
    name: "Ventas",
    href: Pathname.BUSINESS_SALES,
    icon: ShoppingCart,
  },
  {
    name: "Recompensas",
    href: Pathname.BUSINESS_REWARDS,
    icon: Gift,
  },
  {
    name: "Configuración",
    href: Pathname.BUSINESS_SETTINGS,
    icon: Settings,
  },
];

function handleLogout() {
  const service = new BusinessService();

  service.logout().then(() => {
    window.location.href = Pathname.LOGIN;

    localStorage.removeItem(BUSINESS_TOKEN_KEY);
  });
}
---

<aside
  class='flex h-full w-full flex-col border-r border-sidebar-border bg-sidebar lg:fixed lg:left-0 lg:top-0 lg:z-40 lg:h-screen lg:w-64'
>
  <div class='flex h-full flex-col'>
    <div
      class='hidden h-16 items-center gap-2 border-b border-sidebar-border px-6 lg:flex'
    >
      <div
        class='flex h-10 w-10 items-center justify-center rounded-lg bg-sidebar-primary'
      >
        <Store class='h-6 w-6 text-sidebar-primary-foreground' />
      </div>
      <div class='flex flex-col'>
        <span class='text-base font-semibold text-sidebar-foreground'
          >{APP_NAME}</span
        >
        <span class='text-xs text-muted-foreground'>Sistema de puntos</span>
      </div>
    </div>

    {/* Navigation */}
    <nav class='flex-1 space-y-1 p-4'>
      {
        navigation.map((item) => {
          const isActive = Astro.url.pathname === item.href;

          return (
            <a
              href={item.href}
              class={cn(
                "flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-colors",
                isActive
                  ? "bg-sidebar-accent text-sidebar-accent-foreground"
                  : "text-sidebar-foreground hover:bg-sidebar-accent/50 hover:text-sidebar-accent-foreground"
              )}
            >
              <item.icon class='h-5 w-5' />
              {item.name}
            </a>
          );
        })
      }
    </nav>

    {/* Footer */}
    <div class='border-t border-sidebar-border p-4 space-y-3'>
      <Button
        variant='ghost'
        onClick={handleLogout}
        className='w-full justify-start gap-3 text-sidebar-foreground hover:bg-sidebar-accent/50 hover:text-sidebar-accent-foreground'
      >
        <LogOut class='h-5 w-5' />
        Cerrar sesión
      </Button>

      <div
        class='flex items-center gap-3 rounded-lg bg-sidebar-accent/50 px-3 py-2.5'
      >
        <div
          class='flex h-8 w-8 items-center justify-center rounded-full bg-sidebar-primary text-xs font-semibold text-sidebar-primary-foreground'
        >
          MC
        </div>
        <div class='flex flex-col'>
          <span class='text-sm font-medium text-sidebar-foreground'
            >Mi Comercio</span
          >
          <span class='text-xs text-muted-foreground'>Plan Premium</span>
        </div>
      </div>
    </div>
  </div>
</aside>
